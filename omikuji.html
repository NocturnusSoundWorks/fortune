<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>おみくじ結果</title>

<style>
body{
  margin:0;
  background:black;
  color:white;
  font-family:"Noto Sans JP", sans-serif;
  display:flex;
  justify-content:center;
  align-items:center;
  height:100vh;
  flex-direction:column;
  overflow:hidden;
}

/* 結果表示 */
#result{
  font-size:60px;
  letter-spacing:8px;
  opacity:0;
  transform:translateY(20px);
}
#caption{
  margin-top:30px;
  font-size:16px;
  max-width:500px;
  line-height:1.8;
  opacity:0;
}

/* 5秒かけて浮かび上がる */
.fade-in{
  animation: reveal 5s ease forwards;
}

@keyframes reveal{
  to{
    opacity:1;
    transform:translateY(0);
  }
}

/* 戻るボタン */
#back{
  margin-top:40px;
  opacity:0;
  transition: opacity 1.5s ease;
}

#back a{
  color:white;
  text-decoration:none;
  border:1px solid white;
  padding:12px 28px;
  border-radius:30px;
  font-size:14px;
  letter-spacing:2px;
  transition:.3s;
}

#back a:hover{
  background:white;
  color:black;
}
</style>
</head>

<body>

<div id="result"></div>
<div id="caption"></div>
<div id="back">
  <a href="#" id="backLink">トップへ戻る</a>
</div>

<script>
const results = ["大吉","中吉","小吉","吉","末吉","平","凶","大凶"];
const captions = {
  "大吉":"最高にハッピーな流れ。自信を持って進むほど良い結果に近づきます。",
  "中吉":"とても良い運気。謙虚さを忘れなければさらに上向いていきます。",
  "小吉":"小さな幸せが積み重なる日。コツコツが嬉しい実りに変わります。",
  "吉":"安定した順調さがあります。欲張らず今あるものを大切に。",
  "末吉":"ここから運気が伸びていく途中段階。焦らず整えるのが鍵。",
  "平":"大きな波は立ちません。穏やかな気持ちで心地よく過ごせます。",
  "凶":"少し注意が必要な流れ。慎重な選択があなたを守ります。",
  "大凶":"停滞気味の運気。無理をせず、回復のタイミングを待ちましょう。"
};


// 確率（以前と同じ）
const weights = [6, 15, 23, 23, 23, 7, 2, 1];

function weightedRandom() {
  const total = weights.reduce((a,b)=>a+b,0);
  let r = Math.random() * total;

  for (let i = 0; i < weights.length; i++) {
    if (r < weights[i]) return i;
    r -= weights[i];
  }
  return 0;
}

// ページ読み込みと同時に抽選開始
window.onload = function(){

  const index = weightedRandom();
  const resultText = results[index];

  const resultEl = document.getElementById("result");
  const captionEl = document.getElementById("caption");

  resultEl.textContent = resultText;

  // 結果フェードイン
  setTimeout(()=>{
    resultEl.classList.add("fade-in");
  }, 500);

  // 3秒後にキャプション表示開始
  setTimeout(()=>{
    captionEl.style.opacity = 1;
    typeWriter(captions[resultText], captionEl, 0);
  }, 3000);

};
function typeWriter(text, element, index){
  if(index < text.length){
    element.textContent += text.charAt(index);
    setTimeout(()=>{
      typeWriter(text, element, index + 1);
    }, 50); // ←タイピング速度（小さいほど速い）
  } else {
    // 打ち終わったら戻るボタン表示
    document.getElementById("back").style.opacity = "1";
  }
}
// 戻るボタンのリンク先をログイン状態で切り替える
const backLink = document.getElementById("backLink");

if (localStorage.getItem("loginUser")) {
  // ログインしている
  backLink.href = "mainlog.html";
} else {
  // ログインしていない
  backLink.href = "main.html";
}

</script>

</body>
</html>
